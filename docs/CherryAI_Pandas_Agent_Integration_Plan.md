# 📋 CherryAI + pandas_agent 통합 계획서

## 🎯 Executive Summary

현재 CherryAI 프로젝트에는 **4개의 pandas 관련 에이전트**가 존재하며, 새로운 `pandas_agent`를 추가하여 **고도화된 데이터 분석 기능**을 제공하는 계획입니다. 이 통합은 기존 에이전트들과 병행하여 운영되며, 사용자가 선택적으로 활용할 수 있도록 구성됩니다.

---

## 📊 현재 상황 분석

### 🔍 기존 pandas 에이전트 현황

| 에이전트 | 포트 | 기술 스택 | 상태 | 특징 |
|---------|------|----------|------|------|
| `pandas_ai_universal_server.py` | - | **고급 AI 통합 + A2A SDK 0.2.9** | ✅ 완성 | 범용 AI 데이터 분석 |
| `pandas_data_analyst_server.py` | 8200 | LangChain + A2A | ✅ 동작 | 실제 LLM 통합 |
| `pandas_server.py` | 10001 | 기본 pandas + A2A | ✅ 동작 | 단순 분석 |
| `mcp_agents/pandas_data_analyst_agent/` | - | LangChain + LangGraph | ✅ 동작 | MCP 기반 |

### 🎪 새로운 pandas_agent 특징

**핵심 기능:**
- 🧠 **자연어 데이터 인터페이스**: 일반 언어로 데이터 질의
- 🎨 **시각화 자동 생성**: 차트와 그래프 자동 생성
- 🔍 **지능형 데이터 탐색**: EDA 자동화
- 📊 **시맨틱 데이터 레이어**: 데이터 의미 이해
- 🔗 **다중 데이터소스 연결**: CSV, Excel, SQL, API 지원

---

## 🏗️ 통합 아키텍처 설계

### 📂 디렉토리 구조 계획

```
a2a_ds_servers/
├── pandas_agent/                    # 🆕 새로운 pandas_agent
│   ├── __init__.py
│   ├── server.py                    # A2A 서버 래퍼
│   ├── core/                        # 핵심 엔진
│   │   ├── __init__.py
│   │   ├── agent.py                 # 메인 에이전트 클래스
│   │   ├── llm.py                   # LLM 통합
│   │   ├── smart_dataframe.py       # 지능형 데이터프레임
│   │   └── connectors/              # 데이터 연결자들
│   ├── helpers/                     # 헬퍼 유틸리티
│   │   ├── __init__.py
│   │   ├── cache.py
│   │   ├── logger.py
│   │   └── df_info.py
│   ├── pipelines/                   # 데이터 파이프라인
│   │   ├── __init__.py
│   │   ├── smart_datalake.py
│   │   └── base_logic.py
│   └── ee/                          # 엔터프라이즈 기능
├── pandas_ai_universal_server.py    # 기존 (유지)
├── pandas_data_analyst_server.py    # 기존 (유지)
└── pandas_server.py                 # 기존 (유지)
```

### 🔄 통합 전략

**1단계: 병행 운영**
- 기존 4개 에이전트 **완전 보존**
- 새로운 `pandas_agent` **독립적 추가**
- 포트 분리 운영 (예: 8210)

**2단계: 기능 비교**
- 각 에이전트의 **성능 벤치마크**
- 사용자 **선호도 조사**
- 기능별 **강점 분석**

**3단계: 최적화**
- 최고 성능 에이전트 **주력 채택**
- 나머지는 **특수 목적용** 유지
- 통합 라우팅 시스템 구축

---

## 🛠️ 기술적 구현 계획

### 🔧 A2A 통합 방식

```python
# a2a_ds_servers/pandas_agent/server.py 구조 예시
class PandasAgentExecutor(AgentExecutor):
    def __init__(self):
        self.agent = PandasAgent()  # 핵심 에이전트
        
    async def execute(self, context: RequestContext) -> None:
        # A2A 메시지 → pandas_agent 변환
        # 자연어 쿼리 처리
        # 결과 → A2A 아티팩트 변환
```

### 🎯 핵심 구현 포인트

1. **LLM First 원칙 준수**: LLM의 능력을 최대한으로 끌어내서 범용적으로 동작
2. **A2A SDK 0.2.9 표준 완전 준수**: 최신 A2A 표준 완전 준수
3. **SSE 스트리밍 구현**: 실시간 스트리밍은 반드시 SSE와 ASYNC 방식
4. **범용성 보장**: 특정 데이터셋 하드코딩 금지, 모든 데이터셋에 적용 가능

### 🔐 보안 및 격리

- **독립 포트 운영**: 기존 시스템과 충돌 방지
- **데이터 격리**: 각 에이전트별 독립적 데이터 처리
- **에러 격리**: 한 에이전트 장애가 다른 에이전트에 영향 없음

---

## 📋 단계별 구현 일정

### Phase 1: 기반 구축 (1-2일)
- [ ] 디렉토리 구조 생성
- [ ] A2A 서버 스켈레톤 구현
- [ ] 기본 에이전트 클래스 구현
- [ ] 의존성 관리 설정 (uv 기반)

### Phase 2: 핵심 기능 (2-3일)
- [ ] 자연어 쿼리 처리 엔진
- [ ] 지능형 데이터프레임 구현
- [ ] 시각화 자동 생성
- [ ] 다중 데이터소스 연결자

### Phase 3: A2A 통합 (1-2일)
- [ ] 메시지 변환 레이어
- [ ] 아티팩트 생성 시스템
- [ ] SSE 스트리밍 구현
- [ ] 에러 핸들링

### Phase 4: 테스트 및 최적화 (1-2일)
- [ ] 단위 테스트 (pytest)
- [ ] 통합 테스트
- [ ] UI 테스트 (Playwright)
- [ ] 성능 벤치마크

---

## 🎯 최종 목표

**단기 목표 (1주)**
- ✅ 기존 4개 + 새로운 1개 = **총 5개 pandas 에이전트** 병행 운영
- ✅ 각각 독립적이고 안정적인 작동
- ✅ 사용자 선택적 활용 가능

**중기 목표 (2-3주)**
- 📊 성능 비교 및 사용자 피드백 수집
- 🏆 최적의 에이전트 조합 도출
- 🔗 통합 라우팅 시스템 구축

**장기 목표 (1-2개월)**
- 🚀 최고 성능 에이전트 주력 채택
- 🔧 특수 목적용 에이전트들 유지
- 🌟 세계 최고 수준의 AI 데이터 분석 플랫폼 완성

---

## ✅ 승인 사항

1. **기존 4개 에이전트 완전 보존** - ✅ 승인됨
2. **새로운 pandas_agent 독립 추가** - ✅ 승인됨
3. **병행 운영 후 성능 비교** - ✅ 승인됨
4. **포트 8210 사용** - ✅ 승인됨

---

## 📅 작성일시
- **작성일**: 2025년 1월 25일
- **승인일**: 2025년 1월 25일
- **상태**: 구현 준비 완료 